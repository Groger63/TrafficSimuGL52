/** 
 * 
 */
package ^agent

import environnement.Car
import utils.Converter
import ^agent.BehaviorSeeking
/** 
 * @author Nicolas
 * 
 * Comportement que le conducteur adoptera lorsqu'une voiture se situera dans son champs de vision
 */
class BehaviorArriving {
	val stopDistance : float = 10
	def run(body : Car, distanceFromObject : float , maxSpeed : float) : float
	{
		var acc : float
		var slowDownDistance = ((Converter.convertMStoKM(body.speed) / 10) * 6) + stopDistance
		if (slowDownDistance < stopDistance)  
			slowDownDistance = stopDistance 
		if (distanceFromObject > slowDownDistance + stopDistance)
			return new BehaviorSeeking().run(body, maxSpeed) 
		else
			acc =  (new BehaviorFollowing()).computeIDM(body.maxAcc, body.maxDesc, distanceFromObject, body.speed,
				 maxSpeed, 0, slowDownDistance) 
			//computeIDM(body.speed, body.maxAcc, body.maxDesc, distanceFromObject, slowDownDistance, maxSpeed)
		if((body.speed + acc) < 0)
		{
			return -body.speed
		}
		return acc
	}
} 